<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script defer src="js/vue.js"></script>
    <script defer src="js/main.js"></script>
    <title>Твой задачник</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<div id="app">
    <div style="display: flex; flex-direction: column; width: max-content; gap: 10px; margin-top: 20px">
        <button class="button" @click="clearStorage()"><img src="assets/trashBox.png" alt="trashBox"><strong>ALL</strong></button>
        <button class="button" @click="showCard()"><img src="assets/plass.png" alt="plass"></button>
    </div>
    <div>
        <div v-for="(column, index) in columns" :key="index" class="column">
            <h2>{{ column.title }}</h2>
            <div v-for="(card, cardIndex) in column.cards" :key="cardIndex" class="card">
                <div style="display: flex; flex-direction: column; align-items: start">
                    <div>
                        <strong>Дата создания: </strong>{{ formatDate(new Date(card.createAt)) }}
                    </div>
                    <h3>Название: {{ card.title }}</h3>
                </div>
                <div v-for="(item, itemIndex) in card.items" :key="itemIndex">
                    <p>Описание: {{ item.description }}</p>
                    <p v-if="index === 1 && item.taskReturn !== ''">Причина возврата: {{ item.taskReturn }}</p>
                    <p>Сделать до: {{ item.deadline }}</p>
                </div>
                <div class="description" v-if="card.showInputs">
                    <textarea v-if="index === 0 || index === 1 || index === 2" v-model="newTaskDescription[columns.findIndex(column => column.cards.includes(card))]" placeholder="Введите описание задачи"></textarea>
                    <textarea v-if="index === 2" v-model="newTaskReturn[columns.findIndex(column => column.cards.includes(card))]" placeholder="Введите причину возврата"></textarea>
                    <input type="date" v-if="index === 0" v-model="newTaskDate[columns.findIndex(column => column.cards.includes(card))]">
                    <button style="width: 20%;" v-if="index === 0 || index === 1 || index === 2" @click="addTask(card); show(card.id)">+</button>
                </div>
                <p style="color: red" id="error"></p>
                <div class="buttonOne">
                    <button v-if="index === 0" @click="removeCard(index, cardIndex)"><img src="assets/trashBox.png" alt="trashBox"></button>
                    <button v-if="index === 0 || index === 1 || index === 2" @click="show(card.id)"><img src="assets/plass.png" alt="plass"></button>
                    <button style="width: max-content" v-if="index === 0" @click="updateCompletion(card)">в работу</button>
                    <button style="width: max-content" v-if="index === 1" @click="updateCompletion(card)">Тестирование</button>
                    <button style="width: max-content" v-if="index === 2 " @click="addReturn(card); returnCard(card)">Возврат</button>
                    <button style="width: max-content" v-if="index === 2" @click="updateCompletion(card)">Выполнено</button>
                </div>
                <div v-if="card.completedAt">
                    <strong>Последнее изменение: </strong>{{ formatDate(new Date(card.completedAt)) }}
                </div>
            </div>
            <div style="display: flex; gap: 20px">
                <input class="cart" v-if="index === 0" type="text" v-model="newCardTitle[index]" placeholder="Введите заголовок" />
                <button class="cart" v-if="index === 0" @click="addCard(index); showCard()">Добавить карточку</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
